<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="renderer" content="webkit">
  		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>电网system</title>
		<link rel="stylesheet" type="text/css" href="__STATIC__/admin/layui/css/layui.css"/>
		<link rel="stylesheet" type="text/css" href="__STATIC__/admin/css/admin.css"/>
	</head>
	<body>
	<form class="layui-form column-content-detail" method="post" action="{:url('project/allocation_set')}">
		<input type="text" name="passive_project_id" style="display: none" lay-verify="required" lay-verType="tips" autocomplete="off" class="layui-input" value="{$_GET['project_id']}">
		<input type="text" name="passive_woker_id" style="display: none" required lay-verify="required" lay-verType="tips" autocomplete="off" class="layui-input" value="{$_GET['woker_id']}">
		<input type="text" name="supply_goods_id" style="display: none" required lay-verify="required" lay-verType="tips" autocomplete="off" class="layui-input" value="{$_GET['supply_goods_id']}">
		<input type="text" name="contract_id" style="display: none" required lay-verify="required" lay-verType="tips" autocomplete="off" class="layui-input" value="{$_GET['contract_id']}">
					<div class="layui-tab">
						<!-- <ul class="layui-tab-title">
							<li class="layui-this">文章内容</li>
							<li>SEO优化</li>
						</ul> -->
						<div class="layui-tab-content">
							<div class="layui-tab-item layui-show">
								<div class="layui-form-item">
									<div class="layui-inline">
										<label class="layui-form-label">项目：</label>
										<div class="layui-input-block">
											<select name="project_id" lay-filter="project_id" required lay-verify="required" lay-verType="tips" lay-search="">
												<option value="">请选择项目</option>
												{volist name="project_list" id="vo"}
												<option value="{$vo['id']}">{$vo['name']}</option>
												{/volist}
											</select>
										</div>
									</div>
								</div>

								<div class="layui-form-item">
									<div class="layui-inline">
										<label class="layui-form-label">工程队：</label>
										<div class="layui-input-block">
											<select name="woker_id" id="woker_id" lay-filter="woker_id" >
											</select>
										</div>
									</div>
								</div>

								<div class="layui-form-item">
									<div class="layui-inline">
										<label class="layui-form-label">数量：</label>
										<div class="layui-input-block">
											<input type="number" name="num" required lay-verify="required|number" lay-verType="tips" placeholder="请输入数量" autocomplete="off" class="layui-input" value="">
										</div>
									</div>
								</div>

								<div class="layui-form-item">
									<div class="layui-inline">
										<label class="layui-form-label">备注：</label>
										<div class="layui-input-inline" >
											<input type="text" name="note" lay-verify="" lay-verType="tips" placeholder="请输入备注" autocomplete="off" class="layui-input note" value="">
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="layui-form-item" style="padding-left: 10px;">
						<div class="layui-input-block">
							<button class="layui-btn layui-btn-normal" lay-submit lay-filter="formDemo">立即提交</button>
							<button type="reset" class="layui-btn layui-btn-primary">重置</button>
						</div>
					</div>
				</form>
	<script src="__STATIC__/admin/layui/layui.js" type="text/javascript" charset="utf-8"></script>
	<script src="__STATIC__/admin/js/common.js" type="text/javascript" charset="utf-8"></script>
	<script>
		layui.use(['form', 'jquery', 'laydate', 'layer', 'laypage', 'dialog', 'tool', 'element', 'layedit'], function() {
				var form = layui.form,
					layer = layui.layer,
					$ = layui.jquery,
					laypage = layui.laypage,
					laydate = layui.laydate,
					layedit = layui.layedit,
					tool = layui.tool,
					element = layui.element,
					dialog = layui.dialog;
				form.on('select(project_id)', function(data) {
                    var project_id = data.value;
                    $.ajax({
						type:"GET",
						url:"{:url('project/worl_list')}",
						dataType:"json",
						data:{'project_id':project_id},
						success:function(e){
                            var w_data = JSON.parse(e)['data'];
                            //empty() 方法从被选元素移除所有内容
							$("select[name='woker_id']").empty();
							var html = "<option value='0'>请选择工程队</option>";
							$(w_data).each(function (v, k) {
								html += "<option value='" + k.woker_id + "'>" + k.name + "</option>";
							});
							//把遍历的数据放到select表里面
							$("select[name='woker_id']").append(html);
							//从新刷新了一下下拉框
							form.render('select');
						}
					})
				});
                form.on('submit(formDemo)', function (data) {

                    var url = data.form.action;
                    var param = data.field;

                    loading = layer.load(2, {
                        shade: [0.2, '#000']
                    });
                    
                    $.post(url, param, function (data) {
                    	layer.close(loading);
						console.dir(data);
                    	if(data.error_code){ 
                            layer.msg(data.msg, {icon: 2, shade: 0.1, time: 1000}, function(){ 

                            });
                            return false;
                        } 
                    	layer.msg(data.msg, {icon: 1, shade: 0.1, time: 1000}, function () {
                            parent.refresh();
                        });
                    });
                    
                	return false;
                });

				


			});
	</script>
	</body>
</html>